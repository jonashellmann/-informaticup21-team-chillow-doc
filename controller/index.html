<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.2" />
<title>chillow.controller API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>chillow.controller</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">from chillow.controller.online_controller import OnlineController
from chillow.controller.offline_controller import OfflineController
from chillow.controller.ai_evaluation_controller import AIEvaluationController

__all__ = [&#39;OnlineController&#39;, &#39;OfflineController&#39;, &#39;AIEvaluationController&#39;]</code></pre>
</details>
</section>
<section>
<h2 class="section-title" id="header-submodules">Sub-modules</h2>
<dl>
<dt><code class="name"><a title="chillow.controller.ai_evaluation_controller" href="ai_evaluation_controller.html">chillow.controller.ai_evaluation_controller</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="chillow.controller.controller" href="controller.html">chillow.controller.controller</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="chillow.controller.offline_controller" href="offline_controller.html">chillow.controller.offline_controller</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="chillow.controller.online_controller" href="online_controller.html">chillow.controller.online_controller</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="chillow.controller.AIEvaluationController"><code class="flex name class">
<span>class <span class="ident">AIEvaluationController</span></span>
<span>(</span><span>runs: int, db_path: str, evaluation_type: int)</span>
</code></dt>
<dd>
<div class="desc"><p>Executes multiple games after each other with randomly created games and players.</p>
<p>The result of every game and the execution time for each player in each round is saved in an SQLite database.</p>
<p>Creates a new AI evaluation controller.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>runs</code></strong></dt>
<dd>The number of games to be simulated.</dd>
<dt><strong><code>db_path</code></strong></dt>
<dd>The path of the SQLite database file.</dd>
<dt><strong><code>evaluation_type</code></strong></dt>
<dd>Defines which evaluation should be performed</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class AIEvaluationController(OfflineController):
    &#34;&#34;&#34;Executes multiple games after each other with randomly created games and players.

    The result of every game and the execution time for each player in each round is saved in an SQLite database.&#34;&#34;&#34;

    def __init__(self, runs: int, db_path: str, evaluation_type: int):
        &#34;&#34;&#34; Creates a new AI evaluation controller.

        Args:
            runs: The number of games to be simulated.
            db_path: The path of the SQLite database file.
            evaluation_type: Defines which evaluation should be performed
        &#34;&#34;&#34;
        super().__init__(HeadlessView())
        self.__runs = runs
        self.__db_path = db_path
        if 1 &lt;= evaluation_type &lt;= 2:
            self.__evaluation_type = evaluation_type
        else:
            self.__evaluation_type = 1
        self.__connection = None
        self.__cursor = None
        self.__current_game_id = None

    def play(self):
        &#34;&#34;&#34;See base class.&#34;&#34;&#34;
        with closing(sqlite3.connect(self.__db_path)) as connection:
            with closing(connection.cursor()) as cursor:
                self.__connection = connection
                self.__cursor = cursor

                self.__create_db_tables()

                max_game_id = self.__cursor.execute(&#34;SELECT MAX(id) FROM games&#34;).fetchone()[0]
                if max_game_id is None:
                    max_game_id = 0

                self.__run_simulations(max_game_id)

    def _create_game(self) -&gt; None:
        height = randint(30, 70)
        width = randint(30, 70)

        player_count = randint(3, 6)
        players = []
        occupied_coordinates = []
        for i in range(1, player_count + 1):
            next_coordinate = (randint(0, width - 1), randint(0, height - 1))
            while next_coordinate in occupied_coordinates:
                next_coordinate = (randint(0, width - 1), randint(0, height - 1))
            occupied_coordinates.append(next_coordinate)
            player = Player(i, next_coordinate[0], next_coordinate[1], Direction.get_random_direction(), 1, True,
                            str(i))
            players.append(player)

        cells = [[Cell() for _ in range(width)] for _ in range(height)]
        for player in players:
            cells[player.y][player.x] = Cell([player])

        self._game = Game(width, height, cells, players, 1, True, datetime.now() + timedelta(5, 15))
        self._game_round = 0

        self._ais = []

        if self.__evaluation_type == 1:
            self.__generate_ais_for_first_evaluation(player_count, players)
        elif self.__evaluation_type == 2:
            self.__generate_ais_for_second_evaluation(player_count, players)

    def __generate_ais_for_first_evaluation(self, player_count: int, players: List[Player]) -&gt; None:
        self._ais.append(PathfindingAI(players[0], randint(1, 3), randint(1, 3) * 25))
        self._ais.append(PathfindingSearchTreeAI(players[1], randint(1, 3), randint(1, 3) * 25, randint(2, 3), 0.75,
                                                 randint(1, 3) * 10))
        self._ais.append(SearchTreePathfindingAI(players[2], randint(1, 3), randint(1, 3) * 25, 2,
                                                 randint(1, 3) * 10))
        if player_count &gt; 3:
            self._ais.append(SearchTreeAI(players[3], randint(1, 3), randint(2, 3), True, randint(1, 3) * 10))
            if player_count &gt; 4:
                self._ais.append(NotKillingItselfAI(players[4], [AIOptions.max_distance], randint(1, 3), 0,
                                                    randint(1, 3)))
                if player_count &gt; 5:
                    self._ais.append(RandomAI(players[5], randint(1, 3)))

    def __generate_ais_for_second_evaluation(self, player_count: int, players: List[Player]) -&gt; None:
        used_ai_indices = []
        for i in range(player_count):
            ai_index = randint(0, len(best_ais_configurations) - 1)
            # Prevent that the same AI configuration is used in one game
            while ai_index in used_ai_indices:
                ai_index = randint(0, len(best_ais_configurations) - 1)

            used_ai_indices.append(ai_index)
            ai = best_ais_configurations[ai_index]
            self._ais.append(globals()[ai[0]](players[i], *ai[1]))

    def __run_simulations(self, max_game_id):
        for i in range(self.__runs):
            self.__current_game_id = i + 1 + max_game_id
            super().play()

            self.__cursor.execute(&#34;INSERT INTO games VALUES ({}, {}, {}, &#39;{}&#39;, NULL)&#34;
                                  .format(self.__current_game_id, self._game.width, self._game.height,
                                          datetime.now(timezone.utc)))

            winner_player = self._game.get_winner()
            for ai in self._ais:
                ai_class = ai.__class__.__name__
                ai_info = ai.get_information()
                player_id = self.__get_player_id(ai_class, ai_info)

                # Save how often an AI configuration participated in a game
                self.__cursor.execute(&#34;INSERT INTO participants VALUES ({}, {})&#34;
                                      .format(player_id, self.__current_game_id))

                # Save how often an AI configuration won a game
                if ai.player == winner_player:
                    self.__cursor.execute(&#34;UPDATE games SET winner_id = {} WHERE id = {}&#34;
                                          .format(player_id, self.__current_game_id))

            self.__connection.commit()

    def __create_db_tables(self):
        self.__cursor.execute(&#34;CREATE TABLE IF NOT EXISTS players (&#34;
                              &#34;id INTEGER NOT NULL PRIMARY KEY,&#34;
                              &#34;class TEXT NOT NULL,&#34;
                              &#34;info TEXT)&#34;)
        self.__cursor.execute(&#34;CREATE TABLE IF NOT EXISTS games (&#34;
                              &#34;id INTEGER NOT NULL PRIMARY KEY,&#34;
                              &#34;width INTEGER NOT NULL,&#34;
                              &#34;height INTEGER NOT NULL,&#34;
                              &#34;date TEXT NOT NULL,&#34;
                              &#34;winner_id INTEGER,&#34;
                              &#34;FOREIGN KEY (winner_id) REFERENCES players (id))&#34;)
        self.__cursor.execute(&#34;CREATE TABLE IF NOT EXISTS participants (&#34;
                              &#34;player_id INTEGER NOT NULL,&#34;
                              &#34;game_id INTEGER NOT NULL,&#34;
                              &#34;PRIMARY KEY(player_id, game_id),&#34;
                              &#34;FOREIGN KEY (player_id) REFERENCES players (id),&#34;
                              &#34;FOREIGN KEY (game_id) REFERENCES games (id))&#34;)
        self.__cursor.execute(&#34;CREATE TABLE IF NOT EXISTS execution_times (&#34;
                              &#34;player_id INTEGER NOT NULL,&#34;
                              &#34;game_id INTEGER NOT NULL,&#34;
                              &#34;game_round INTEGER NOT NULL,&#34;
                              &#34;execution REAL NOT NULL,&#34;
                              &#34;PRIMARY KEY(player_id, game_id, game_round),&#34;
                              &#34;FOREIGN KEY (player_id) REFERENCES players (id),&#34;
                              &#34;FOREIGN KEY (game_id) REFERENCES games (id))&#34;)

    def _log_execution_time(self, ai: ArtificialIntelligence, execution_time: float):
        ai_class = ai.__class__.__name__
        ai_info = ai.get_information()
        player_id = self.__get_player_id(ai_class, ai_info)

        self.__cursor.execute(&#34;INSERT INTO execution_times VALUES ({}, {}, {}, {})&#34;
                              .format(player_id, self.__current_game_id, self._game_round, execution_time))

    def __get_player_id(self, ai_class: str, ai_info: str) -&gt; int:
        player_id = self.__cursor.execute(
            &#34;SELECT MAX(id) FROM players p WHERE p.class = &#39;{}&#39; AND p.info = &#39;{}&#39;&#34;
            .format(ai_class, ai_info)).fetchone()[0]

        if player_id is None:
            max_player_id = self.__cursor.execute(&#34;SELECT MAX(id) FROM players&#34;).fetchone()[0]
            if max_player_id is None:
                max_player_id = 0
            player_id = max_player_id + 1
            self.__cursor.execute(&#34;INSERT INTO players VALUES ({}, &#39;{}&#39;, &#39;{}&#39;)&#34;.format(player_id, ai_class, ai_info))

        return player_id</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="chillow.controller.offline_controller.OfflineController" href="offline_controller.html#chillow.controller.offline_controller.OfflineController">OfflineController</a></li>
<li><a title="chillow.controller.controller.Controller" href="controller.html#chillow.controller.controller.Controller">Controller</a></li>
</ul>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="chillow.controller.offline_controller.OfflineController" href="offline_controller.html#chillow.controller.offline_controller.OfflineController">OfflineController</a></b></code>:
<ul class="hlist">
<li><code><a title="chillow.controller.offline_controller.OfflineController.play" href="offline_controller.html#chillow.controller.offline_controller.OfflineController.play">play</a></code></li>
</ul>
</li>
</ul>
</dd>
<dt id="chillow.controller.OfflineController"><code class="flex name class">
<span>class <span class="ident">OfflineController</span></span>
<span>(</span><span>view: <a title="chillow.view.view.View" href="../view/view.html#chillow.view.view.View">View</a>)</span>
</code></dt>
<dd>
<div class="desc"><p>Connects the services to execute the game logic and controls an UI.</p>
<p>Creates a new offline controller.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>view</code></strong></dt>
<dd>The UI that should be used.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class OfflineController(Controller):

    def __init__(self, view: View):
        &#34;&#34;&#34;Creates a new offline controller.

        Args:
            view: The UI that should be used.
        &#34;&#34;&#34;
        super().__init__(view)
        self.__you = None
        self._game = None
        self._game_round = 0
        self._ais = []

    def play(self):
        &#34;&#34;&#34;See base class.&#34;&#34;&#34;
        self._create_game()
        game_service = GameService(self._game, ignore_deadline=False)

        self._view.update(self._game)

        while self._game.running:
            self._game_round += 1
            time_to_react = randint(4, 16)
            self.__reset_game_deadline(time_to_react)

            # Read input from user if there is a human player
            player_action = None
            if self.__you is not None and self.__you.active:
                player_action = self._view.read_next_action()
                if datetime.now(time_zone) &gt; self._game.deadline:
                    player_action = Action.get_default()
                self.__reset_game_deadline(time_to_react)

            for ai in self._ais:
                if ai is not None and ai.player.active:
                    action = self.__choose_ai_action(ai, time_to_react)
                    game_service.do_action(ai.player, action)
                    self.__reset_game_deadline(time_to_react)

            # Perform action of human player after AIs finished their calculations
            # Otherwise the AIs would already know the players move
            if self.__you is not None and player_action is not None:
                game_service.do_action(self.__you, player_action)

            self._view.update(self._game)

    def _create_game(self) -&gt; None:
        player1 = Player(1, 5, 5, Direction.down, 1, True, &#34;Human Player 1&#34;)
        player2 = Player(2, 25, 5, Direction.down, 1, True, &#34;AI Player 1&#34;)
        player3 = Player(3, 5, 15, Direction.up, 1, True, &#34;AI Player 2&#34;)
        player4 = Player(4, 25, 15, Direction.up, 1, True, &#34;AI Player 4&#34;)
        players = [player1, player2, player3, player4]
        height = 20
        width = 30
        cells = [[Cell() for _ in range(width)] for _ in range(height)]
        cells[player1.y][player1.x] = Cell([player1])
        cells[player2.y][player2.x] = Cell([player2])
        cells[player3.y][player3.x] = Cell([player3])
        cells[player4.y][player4.x] = Cell([player4])

        self._game = Game(width, height, cells, players, 1, True, datetime.now(time_zone))
        self._game_round = 0

        self.__you = None
        ai0 = ai_classes.RandomAI(player1)
        # Make a comment out of the next two lines if you do not want to play on your own.
        self.__you = player1
        ai0 = None

        ai1 = ai_classes.PathfindingAI(player2, 2, 75)
        ai2 = ai_classes.NotKillingItselfAI(player3, [ai_classes.AIOptions.max_distance], 1, 0, 3)
        ai3 = ai_classes.SearchTreeAI(player4, 2, 1, True, 10)

        self._ais = [ai0, ai1, ai2, ai3]

    def _log_execution_time(self, ai: ArtificialIntelligence, execution_time: float):
        pass

    def __reset_game_deadline(self, time_to_react: int):
        self._game.deadline = datetime.now(time_zone) + timedelta(0, time_to_react)

    def __choose_ai_action(self, ai: ArtificialIntelligence, time_to_react: int) -&gt; Action:
        return_value = multiprocessing.Value(&#39;i&#39;, Action.get_default().get_index())

        process = multiprocessing.Process(target=Controller.call_ai, args=(ai, self._game.copy(), return_value,))
        start = datetime.now(time_zone)
        process.start()
        process.join(time_to_react - 1)  # wait time_to_react seconds minus one for the calculation to be finished

        if process.is_alive():
            # If an execution is terminated, the execution time is set to 1 minute.
            start = datetime.now(time_zone) - timedelta(seconds=60)
            process.terminate()

        self._log_execution_time(ai, (datetime.now(time_zone) - start).total_seconds())
        return Action.get_by_index(return_value.value)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="chillow.controller.controller.Controller" href="controller.html#chillow.controller.controller.Controller">Controller</a></li>
</ul>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="chillow.controller.ai_evaluation_controller.AIEvaluationController" href="ai_evaluation_controller.html#chillow.controller.ai_evaluation_controller.AIEvaluationController">AIEvaluationController</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="chillow.controller.OfflineController.play"><code class="name flex">
<span>def <span class="ident">play</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>See base class.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def play(self):
    &#34;&#34;&#34;See base class.&#34;&#34;&#34;
    self._create_game()
    game_service = GameService(self._game, ignore_deadline=False)

    self._view.update(self._game)

    while self._game.running:
        self._game_round += 1
        time_to_react = randint(4, 16)
        self.__reset_game_deadline(time_to_react)

        # Read input from user if there is a human player
        player_action = None
        if self.__you is not None and self.__you.active:
            player_action = self._view.read_next_action()
            if datetime.now(time_zone) &gt; self._game.deadline:
                player_action = Action.get_default()
            self.__reset_game_deadline(time_to_react)

        for ai in self._ais:
            if ai is not None and ai.player.active:
                action = self.__choose_ai_action(ai, time_to_react)
                game_service.do_action(ai.player, action)
                self.__reset_game_deadline(time_to_react)

        # Perform action of human player after AIs finished their calculations
        # Otherwise the AIs would already know the players move
        if self.__you is not None and player_action is not None:
            game_service.do_action(self.__you, player_action)

        self._view.update(self._game)</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="chillow.controller.OnlineController"><code class="flex name class">
<span>class <span class="ident">OnlineController</span></span>
<span>(</span><span>view: <a title="chillow.view.view.View" href="../view/view.html#chillow.view.view.View">View</a>, url: str, key: str, server_time_url: str, data_loader: <a title="chillow.service.data_loader.DataLoader" href="../service/data_loader.html#chillow.service.data_loader.DataLoader">DataLoader</a>, data_writer: <a title="chillow.service.data_writer.DataWriter" href="../service/data_writer.html#chillow.service.data_writer.DataWriter">DataWriter</a>, ai_class: str, ai_params)</span>
</code></dt>
<dd>
<div class="desc"><p>Connects the services to execute the game logic and controls an UI.</p>
<p>Creates a new online controller.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>view</code></strong></dt>
<dd>The UI that should be used.</dd>
<dt><strong><code>url</code></strong></dt>
<dd>The URL of the spe_ed server.</dd>
<dt><strong><code>key</code></strong></dt>
<dd>The API key.</dd>
<dt><strong><code>server_time_url</code></strong></dt>
<dd>The URL to request the current time of the server.</dd>
<dt><strong><code>data_loader</code></strong></dt>
<dd>Object to load data.</dd>
<dt><strong><code>data_writer</code></strong></dt>
<dd>Object to write data.</dd>
<dt><strong><code>ai_class</code></strong></dt>
<dd>The name of the AI class to be used.</dd>
<dt><strong><code>ai_params</code></strong></dt>
<dd>The parameters of the AI.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class OnlineController(Controller):

    def __init__(self, view: View, url: str, key: str, server_time_url: str, data_loader: DataLoader,
                 data_writer: DataWriter, ai_class: str, ai_params):
        &#34;&#34;&#34;Creates a new online controller.

        Args:
            view: The UI that should be used.
            url: The URL of the spe_ed server.
            key: The API key.
            server_time_url: The URL to request the current time of the server.
            data_loader: Object to load data.
            data_writer: Object to write data.
            ai_class: The name of the AI class to be used.
            ai_params: The parameters of the AI.
        &#34;&#34;&#34;

        super().__init__(view)
        self.__url = url
        self.__key = key
        self.__server_time_url = server_time_url
        self.__data_loader = data_loader
        self.__data_writer = data_writer
        self.__ai = None
        self.__default_ai = None
        self.__ai_class = ai_class
        self.__ai_params = ai_params

    def play(self):
        &#34;&#34;&#34;See base class.&#34;&#34;&#34;
        asyncio.get_event_loop().run_until_complete(self.__play())
        self._view.end()
        self.__ai = None
        self.__default_ai = None

    async def __play(self):
        async with websockets.connect(f&#34;{self.__url}?key={self.__key}&#34;) as websocket:
            while True:
                game_data = await websocket.recv()
                game = self.__data_loader.load(game_data)

                self._view.update(game)

                if not game.running:
                    break

                try:
                    time_data = requests.get(self.__server_time_url).text
                    server_time = self.__data_loader.read_server_time(time_data)
                except (RequestException, ValueError):
                    server_time = datetime.now(timezone.utc)
                own_time = datetime.now(server_time.tzinfo)
                game.normalize_deadline(server_time, own_time)

                if self.__ai is None:
                    self.__ai = globals()[self.__ai_class](game.you, *self.__ai_params)
                    self.__default_ai = NotKillingItselfAI(game.you, [AIOptions.max_distance], 1, 0, 3)  # noqa: F405

                if game.you.active:
                    action = self.__choose_action(game, server_time.tzinfo)
                    data_out = self.__data_writer.write(action)
                    await websocket.send(data_out)

    def __choose_action(self, game: Game, time_zone: datetime.tzinfo) -&gt; Action:
        return_value = multiprocessing.Value(&#39;i&#39;)
        self.__default_ai.create_next_action(game, return_value)

        own_time = datetime.now(time_zone)
        seconds_for_calculation = (game.deadline - own_time).seconds

        process = multiprocessing.Process(target=Controller.call_ai, args=(self.__ai, game, return_value,))
        process.start()
        process.join(seconds_for_calculation - 1)

        if process.is_alive():
            process.terminate()

        return Action.get_by_index(return_value.value)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="chillow.controller.controller.Controller" href="controller.html#chillow.controller.controller.Controller">Controller</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="chillow.controller.OnlineController.play"><code class="name flex">
<span>def <span class="ident">play</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>See base class.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def play(self):
    &#34;&#34;&#34;See base class.&#34;&#34;&#34;
    asyncio.get_event_loop().run_until_complete(self.__play())
    self._view.end()
    self.__ai = None
    self.__default_ai = None</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="chillow" href="../index.html">chillow</a></code></li>
</ul>
</li>
<li><h3><a href="#header-submodules">Sub-modules</a></h3>
<ul>
<li><code><a title="chillow.controller.ai_evaluation_controller" href="ai_evaluation_controller.html">chillow.controller.ai_evaluation_controller</a></code></li>
<li><code><a title="chillow.controller.controller" href="controller.html">chillow.controller.controller</a></code></li>
<li><code><a title="chillow.controller.offline_controller" href="offline_controller.html">chillow.controller.offline_controller</a></code></li>
<li><code><a title="chillow.controller.online_controller" href="online_controller.html">chillow.controller.online_controller</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="chillow.controller.AIEvaluationController" href="#chillow.controller.AIEvaluationController">AIEvaluationController</a></code></h4>
</li>
<li>
<h4><code><a title="chillow.controller.OfflineController" href="#chillow.controller.OfflineController">OfflineController</a></code></h4>
<ul class="">
<li><code><a title="chillow.controller.OfflineController.play" href="#chillow.controller.OfflineController.play">play</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="chillow.controller.OnlineController" href="#chillow.controller.OnlineController">OnlineController</a></code></h4>
<ul class="">
<li><code><a title="chillow.controller.OnlineController.play" href="#chillow.controller.OnlineController.play">play</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.2</a>.</p>
</footer>
</body>
</html>