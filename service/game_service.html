<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.2" />
<title>chillow.service.game_service API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>chillow.service.game_service</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">import logging
from typing import List, Tuple
from datetime import datetime, timedelta

import chillow.exceptions as ex
from chillow.exceptions import InvalidPlayerMoveException, PlayerSpeedNotInRangeException
from chillow.model.game import Game
from chillow.model.action import Action
from chillow.model.player import Player
from chillow.model.direction import Direction


class GameService:
    &#34;&#34;&#34;Class that manipulates a game object by performing the actions of players.&#34;&#34;&#34;

    def __init__(self, game: Game, ignore_deadline: bool = True):
        &#34;&#34;&#34;Creates a new game service.

        It also creates a turn object that represents the play moves.

        Args:
            game: The game object in which the AI is located and contains the current status of the game.
            ignore_deadline: Flag to ignore the deadline.
        &#34;&#34;&#34;
        self.game = game
        self.turn = Turn(self.game.players)
        self.visited_cells_by_player = {}
        self.__ignore_deadline = ignore_deadline

    def do_action(self, player: Player, action: Action):
        &#34;&#34;&#34;Performs the action for a player.

        Additionally it checks if the game is finished and which players have died when a new turn starts.

        Args:
            player: The player who wants to perform the action.
            action: The action to perform.
        Raises:
            InvalidPlayerMoveException:
                The player is outside the field, has reached an invalid player speed or was not
                allowed to take any further action this turn.
        &#34;&#34;&#34;
        try:
            new_turn = self.turn.action(player)
            action_to_perform = action \
                if self.__ignore_deadline or datetime.now(self.game.deadline.tzinfo) &lt;= self.game.deadline \
                else Action.get_default()
            self.visited_cells_by_player[player.id] = self.get_and_visit_cells(player, action_to_perform)

            if new_turn:
                self.check_and_set_died_players()

        except InvalidPlayerMoveException:
            self.set_player_inactive(player)

        self.game.running = self.is_game_running()

    def check_and_set_died_players(self):
        &#34;&#34;&#34;Checks which players have died this turn and sets them to inactive. &#34;&#34;&#34;
        for row in range(len(self.game.cells)):
            for col in range(len(self.game.cells[row])):
                cell = self.game.cells[row][col]
                if cell.players is not None and len(cell.players) &gt; 1:
                    for player_id, cells in self.visited_cells_by_player.items():
                        for cell in cells:
                            if cell[0] == col and cell[1] == row:
                                for player in self.game.players:
                                    if player_id == player.id:
                                        self.set_player_inactive(player)
                                        logging.debug(&#34;Player with id &#34; + str(player.id)
                                                      + &#34; had a collision and is inactive now&#34;)

    def is_game_running(self) -&gt; bool:
        &#34;&#34;&#34;Checks if the game is still running.

        Returns:
            True if the game is still running otherwise False.
        &#34;&#34;&#34;
        active_player_ctr = 0
        for player in self.game.players:
            if player.active:
                active_player_ctr += 1
        return active_player_ctr &gt;= 2

    @staticmethod
    def get_horizontal_and_vertical_multiplier(player: Player) -&gt; Tuple[int, int]:
        &#34;&#34;&#34;Calculates a vertical and horizontal multiplier that can be used to calculate player movement.

        Args:
            player: The player whose movement is calculated.

        Returns:
            Horizontal and vertical multiplier.
        &#34;&#34;&#34;
        vertical_multiplier = 0
        horizontal_multiplier = 0
        if player.direction == Direction.up:
            vertical_multiplier = -1
        elif player.direction == Direction.down:
            vertical_multiplier = 1
        elif player.direction == Direction.left:
            horizontal_multiplier = -1
        elif player.direction == Direction.right:
            horizontal_multiplier = 1

        return horizontal_multiplier, vertical_multiplier

    def get_and_visit_cells(self, player: Player, action: Action) -&gt; List[Tuple[int, int]]:
        &#34;&#34;&#34;Simulation of a player performing an action.

        Args:
            player: The player who performs the action.
            action: The Action to perform.

        Returns:
            List of field coordinates that the player has visited.
        &#34;&#34;&#34;
        visited_cells = []
        GameService.change_player_status_by_action(player, action)
        horizontal_multiplier, vertical_multiplier = GameService.get_horizontal_and_vertical_multiplier(player)

        for i in range(1, player.speed + 1):
            visited_cells.append((player.x + i * horizontal_multiplier, player.y + i * vertical_multiplier))

        # Gap every sixth move, so take only first and last coordinate
        if self.turn.turn_ctr % 6 == 0 and len(visited_cells) &gt; 1:
            visited_cells = [visited_cells[0], visited_cells[-1]]

        visited_cells_result = []
        for (x, y) in visited_cells:
            if x not in range(self.game.width) or y not in range(self.game.height):
                self.set_player_inactive(player)
                break
            player.x = x
            player.y = y
            visited_cells_result.append((x, y))
            if self.game.cells[y][x].players is None or len(self.game.cells[y][x].players) == 0:
                self.game.cells[y][x].players = [player]
            else:
                self.game.cells[y][x].players.append(player)

        return visited_cells_result

    @staticmethod
    def change_player_status_by_action(player: Player, action: Action):
        &#34;&#34;&#34;Changes the direction of the player based on the action.

        Args:
            player: The player whose direction is to be changed.
            action: The Action to perform.
        &#34;&#34;&#34;
        if action == action.turn_left:
            if player.direction == Direction.up:
                player.direction = Direction.left
            elif player.direction == Direction.left:
                player.direction = Direction.down
            elif player.direction == Direction.down:
                player.direction = Direction.right
            elif player.direction == Direction.right:
                player.direction = Direction.up
        elif action == action.turn_right:
            if player.direction == Direction.up:
                player.direction = Direction.right
            elif player.direction == Direction.right:
                player.direction = Direction.down
            elif player.direction == Direction.down:
                player.direction = Direction.left
            elif player.direction == Direction.left:
                player.direction = Direction.up
        elif action == action.speed_up:
            player.speed += 1
        elif action == action.slow_down:
            player.speed -= 1

        if player.speed not in range(1, 11):
            raise PlayerSpeedNotInRangeException(player)

    def set_player_inactive(self, player: Player):
        &#34;&#34;&#34;Sets a player inactive.

        Args:
            player: The player to be set inactive.
        &#34;&#34;&#34;
        if player in self.turn.playersWithPendingAction:
            self.turn.playersWithPendingAction.remove(player)
        player.active = False


class Turn:
    &#34;&#34;&#34;Class that represents a game turn.&#34;&#34;&#34;

    def __init__(self, players: List[Player]):
        &#34;&#34;&#34;Creates a new game turn.

        Args:
            players: List of players that are in the game.
        &#34;&#34;&#34;
        self.players = players.copy()
        self.playersWithPendingAction = players.copy()
        self.turn_ctr = 1

    def action(self, player):
        &#34;&#34;&#34;Checks if the player is allowed to take an action.

        If so, removes him from the list of players who must take an action this turn.
        In addition a new turn is started when all players have taken an action.

        Args:
            player: Player who wants to perform an action this turn.

        Returns:
            True if the Turn is ended otherwise False.

        Raises:
            MultipleActionByPlayerException: Raised if the player did more than one action this turn.
        &#34;&#34;&#34;
        if player not in self.playersWithPendingAction:
            raise ex.MultipleActionByPlayerException(player)
        else:
            self.playersWithPendingAction.remove(player)
            if len(self.playersWithPendingAction) == 0:
                self.turn_ctr += 1
                for player in self.players:
                    if player.active:
                        self.playersWithPendingAction.append(player)
                return True
            return False</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="chillow.service.game_service.GameService"><code class="flex name class">
<span>class <span class="ident">GameService</span></span>
<span>(</span><span>game: <a title="chillow.model.game.Game" href="../model/game.html#chillow.model.game.Game">Game</a>, ignore_deadline: bool = True)</span>
</code></dt>
<dd>
<div class="desc"><p>Class that manipulates a game object by performing the actions of players.</p>
<p>Creates a new game service.</p>
<p>It also creates a turn object that represents the play moves.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>game</code></strong></dt>
<dd>The game object in which the AI is located and contains the current status of the game.</dd>
<dt><strong><code>ignore_deadline</code></strong></dt>
<dd>Flag to ignore the deadline.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class GameService:
    &#34;&#34;&#34;Class that manipulates a game object by performing the actions of players.&#34;&#34;&#34;

    def __init__(self, game: Game, ignore_deadline: bool = True):
        &#34;&#34;&#34;Creates a new game service.

        It also creates a turn object that represents the play moves.

        Args:
            game: The game object in which the AI is located and contains the current status of the game.
            ignore_deadline: Flag to ignore the deadline.
        &#34;&#34;&#34;
        self.game = game
        self.turn = Turn(self.game.players)
        self.visited_cells_by_player = {}
        self.__ignore_deadline = ignore_deadline

    def do_action(self, player: Player, action: Action):
        &#34;&#34;&#34;Performs the action for a player.

        Additionally it checks if the game is finished and which players have died when a new turn starts.

        Args:
            player: The player who wants to perform the action.
            action: The action to perform.
        Raises:
            InvalidPlayerMoveException:
                The player is outside the field, has reached an invalid player speed or was not
                allowed to take any further action this turn.
        &#34;&#34;&#34;
        try:
            new_turn = self.turn.action(player)
            action_to_perform = action \
                if self.__ignore_deadline or datetime.now(self.game.deadline.tzinfo) &lt;= self.game.deadline \
                else Action.get_default()
            self.visited_cells_by_player[player.id] = self.get_and_visit_cells(player, action_to_perform)

            if new_turn:
                self.check_and_set_died_players()

        except InvalidPlayerMoveException:
            self.set_player_inactive(player)

        self.game.running = self.is_game_running()

    def check_and_set_died_players(self):
        &#34;&#34;&#34;Checks which players have died this turn and sets them to inactive. &#34;&#34;&#34;
        for row in range(len(self.game.cells)):
            for col in range(len(self.game.cells[row])):
                cell = self.game.cells[row][col]
                if cell.players is not None and len(cell.players) &gt; 1:
                    for player_id, cells in self.visited_cells_by_player.items():
                        for cell in cells:
                            if cell[0] == col and cell[1] == row:
                                for player in self.game.players:
                                    if player_id == player.id:
                                        self.set_player_inactive(player)
                                        logging.debug(&#34;Player with id &#34; + str(player.id)
                                                      + &#34; had a collision and is inactive now&#34;)

    def is_game_running(self) -&gt; bool:
        &#34;&#34;&#34;Checks if the game is still running.

        Returns:
            True if the game is still running otherwise False.
        &#34;&#34;&#34;
        active_player_ctr = 0
        for player in self.game.players:
            if player.active:
                active_player_ctr += 1
        return active_player_ctr &gt;= 2

    @staticmethod
    def get_horizontal_and_vertical_multiplier(player: Player) -&gt; Tuple[int, int]:
        &#34;&#34;&#34;Calculates a vertical and horizontal multiplier that can be used to calculate player movement.

        Args:
            player: The player whose movement is calculated.

        Returns:
            Horizontal and vertical multiplier.
        &#34;&#34;&#34;
        vertical_multiplier = 0
        horizontal_multiplier = 0
        if player.direction == Direction.up:
            vertical_multiplier = -1
        elif player.direction == Direction.down:
            vertical_multiplier = 1
        elif player.direction == Direction.left:
            horizontal_multiplier = -1
        elif player.direction == Direction.right:
            horizontal_multiplier = 1

        return horizontal_multiplier, vertical_multiplier

    def get_and_visit_cells(self, player: Player, action: Action) -&gt; List[Tuple[int, int]]:
        &#34;&#34;&#34;Simulation of a player performing an action.

        Args:
            player: The player who performs the action.
            action: The Action to perform.

        Returns:
            List of field coordinates that the player has visited.
        &#34;&#34;&#34;
        visited_cells = []
        GameService.change_player_status_by_action(player, action)
        horizontal_multiplier, vertical_multiplier = GameService.get_horizontal_and_vertical_multiplier(player)

        for i in range(1, player.speed + 1):
            visited_cells.append((player.x + i * horizontal_multiplier, player.y + i * vertical_multiplier))

        # Gap every sixth move, so take only first and last coordinate
        if self.turn.turn_ctr % 6 == 0 and len(visited_cells) &gt; 1:
            visited_cells = [visited_cells[0], visited_cells[-1]]

        visited_cells_result = []
        for (x, y) in visited_cells:
            if x not in range(self.game.width) or y not in range(self.game.height):
                self.set_player_inactive(player)
                break
            player.x = x
            player.y = y
            visited_cells_result.append((x, y))
            if self.game.cells[y][x].players is None or len(self.game.cells[y][x].players) == 0:
                self.game.cells[y][x].players = [player]
            else:
                self.game.cells[y][x].players.append(player)

        return visited_cells_result

    @staticmethod
    def change_player_status_by_action(player: Player, action: Action):
        &#34;&#34;&#34;Changes the direction of the player based on the action.

        Args:
            player: The player whose direction is to be changed.
            action: The Action to perform.
        &#34;&#34;&#34;
        if action == action.turn_left:
            if player.direction == Direction.up:
                player.direction = Direction.left
            elif player.direction == Direction.left:
                player.direction = Direction.down
            elif player.direction == Direction.down:
                player.direction = Direction.right
            elif player.direction == Direction.right:
                player.direction = Direction.up
        elif action == action.turn_right:
            if player.direction == Direction.up:
                player.direction = Direction.right
            elif player.direction == Direction.right:
                player.direction = Direction.down
            elif player.direction == Direction.down:
                player.direction = Direction.left
            elif player.direction == Direction.left:
                player.direction = Direction.up
        elif action == action.speed_up:
            player.speed += 1
        elif action == action.slow_down:
            player.speed -= 1

        if player.speed not in range(1, 11):
            raise PlayerSpeedNotInRangeException(player)

    def set_player_inactive(self, player: Player):
        &#34;&#34;&#34;Sets a player inactive.

        Args:
            player: The player to be set inactive.
        &#34;&#34;&#34;
        if player in self.turn.playersWithPendingAction:
            self.turn.playersWithPendingAction.remove(player)
        player.active = False</code></pre>
</details>
<h3>Static methods</h3>
<dl>
<dt id="chillow.service.game_service.GameService.change_player_status_by_action"><code class="name flex">
<span>def <span class="ident">change_player_status_by_action</span></span>(<span>player: <a title="chillow.model.player.Player" href="../model/player.html#chillow.model.player.Player">Player</a>, action: <a title="chillow.model.action.Action" href="../model/action.html#chillow.model.action.Action">Action</a>)</span>
</code></dt>
<dd>
<div class="desc"><p>Changes the direction of the player based on the action.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>player</code></strong></dt>
<dd>The player whose direction is to be changed.</dd>
<dt><strong><code>action</code></strong></dt>
<dd>The Action to perform.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def change_player_status_by_action(player: Player, action: Action):
    &#34;&#34;&#34;Changes the direction of the player based on the action.

    Args:
        player: The player whose direction is to be changed.
        action: The Action to perform.
    &#34;&#34;&#34;
    if action == action.turn_left:
        if player.direction == Direction.up:
            player.direction = Direction.left
        elif player.direction == Direction.left:
            player.direction = Direction.down
        elif player.direction == Direction.down:
            player.direction = Direction.right
        elif player.direction == Direction.right:
            player.direction = Direction.up
    elif action == action.turn_right:
        if player.direction == Direction.up:
            player.direction = Direction.right
        elif player.direction == Direction.right:
            player.direction = Direction.down
        elif player.direction == Direction.down:
            player.direction = Direction.left
        elif player.direction == Direction.left:
            player.direction = Direction.up
    elif action == action.speed_up:
        player.speed += 1
    elif action == action.slow_down:
        player.speed -= 1

    if player.speed not in range(1, 11):
        raise PlayerSpeedNotInRangeException(player)</code></pre>
</details>
</dd>
<dt id="chillow.service.game_service.GameService.get_horizontal_and_vertical_multiplier"><code class="name flex">
<span>def <span class="ident">get_horizontal_and_vertical_multiplier</span></span>(<span>player: <a title="chillow.model.player.Player" href="../model/player.html#chillow.model.player.Player">Player</a>) ‑> Tuple[int, int]</span>
</code></dt>
<dd>
<div class="desc"><p>Calculates a vertical and horizontal multiplier that can be used to calculate player movement.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>player</code></strong></dt>
<dd>The player whose movement is calculated.</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>Horizontal and vertical multiplier.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def get_horizontal_and_vertical_multiplier(player: Player) -&gt; Tuple[int, int]:
    &#34;&#34;&#34;Calculates a vertical and horizontal multiplier that can be used to calculate player movement.

    Args:
        player: The player whose movement is calculated.

    Returns:
        Horizontal and vertical multiplier.
    &#34;&#34;&#34;
    vertical_multiplier = 0
    horizontal_multiplier = 0
    if player.direction == Direction.up:
        vertical_multiplier = -1
    elif player.direction == Direction.down:
        vertical_multiplier = 1
    elif player.direction == Direction.left:
        horizontal_multiplier = -1
    elif player.direction == Direction.right:
        horizontal_multiplier = 1

    return horizontal_multiplier, vertical_multiplier</code></pre>
</details>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="chillow.service.game_service.GameService.check_and_set_died_players"><code class="name flex">
<span>def <span class="ident">check_and_set_died_players</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Checks which players have died this turn and sets them to inactive.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def check_and_set_died_players(self):
    &#34;&#34;&#34;Checks which players have died this turn and sets them to inactive. &#34;&#34;&#34;
    for row in range(len(self.game.cells)):
        for col in range(len(self.game.cells[row])):
            cell = self.game.cells[row][col]
            if cell.players is not None and len(cell.players) &gt; 1:
                for player_id, cells in self.visited_cells_by_player.items():
                    for cell in cells:
                        if cell[0] == col and cell[1] == row:
                            for player in self.game.players:
                                if player_id == player.id:
                                    self.set_player_inactive(player)
                                    logging.debug(&#34;Player with id &#34; + str(player.id)
                                                  + &#34; had a collision and is inactive now&#34;)</code></pre>
</details>
</dd>
<dt id="chillow.service.game_service.GameService.do_action"><code class="name flex">
<span>def <span class="ident">do_action</span></span>(<span>self, player: <a title="chillow.model.player.Player" href="../model/player.html#chillow.model.player.Player">Player</a>, action: <a title="chillow.model.action.Action" href="../model/action.html#chillow.model.action.Action">Action</a>)</span>
</code></dt>
<dd>
<div class="desc"><p>Performs the action for a player.</p>
<p>Additionally it checks if the game is finished and which players have died when a new turn starts.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>player</code></strong></dt>
<dd>The player who wants to perform the action.</dd>
<dt><strong><code>action</code></strong></dt>
<dd>The action to perform.</dd>
</dl>
<h2 id="raises">Raises</h2>
<p>InvalidPlayerMoveException:
The player is outside the field, has reached an invalid player speed or was not
allowed to take any further action this turn.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def do_action(self, player: Player, action: Action):
    &#34;&#34;&#34;Performs the action for a player.

    Additionally it checks if the game is finished and which players have died when a new turn starts.

    Args:
        player: The player who wants to perform the action.
        action: The action to perform.
    Raises:
        InvalidPlayerMoveException:
            The player is outside the field, has reached an invalid player speed or was not
            allowed to take any further action this turn.
    &#34;&#34;&#34;
    try:
        new_turn = self.turn.action(player)
        action_to_perform = action \
            if self.__ignore_deadline or datetime.now(self.game.deadline.tzinfo) &lt;= self.game.deadline \
            else Action.get_default()
        self.visited_cells_by_player[player.id] = self.get_and_visit_cells(player, action_to_perform)

        if new_turn:
            self.check_and_set_died_players()

    except InvalidPlayerMoveException:
        self.set_player_inactive(player)

    self.game.running = self.is_game_running()</code></pre>
</details>
</dd>
<dt id="chillow.service.game_service.GameService.get_and_visit_cells"><code class="name flex">
<span>def <span class="ident">get_and_visit_cells</span></span>(<span>self, player: <a title="chillow.model.player.Player" href="../model/player.html#chillow.model.player.Player">Player</a>, action: <a title="chillow.model.action.Action" href="../model/action.html#chillow.model.action.Action">Action</a>) ‑> List[Tuple[int, int]]</span>
</code></dt>
<dd>
<div class="desc"><p>Simulation of a player performing an action.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>player</code></strong></dt>
<dd>The player who performs the action.</dd>
<dt><strong><code>action</code></strong></dt>
<dd>The Action to perform.</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>List of field coordinates that the player has visited.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_and_visit_cells(self, player: Player, action: Action) -&gt; List[Tuple[int, int]]:
    &#34;&#34;&#34;Simulation of a player performing an action.

    Args:
        player: The player who performs the action.
        action: The Action to perform.

    Returns:
        List of field coordinates that the player has visited.
    &#34;&#34;&#34;
    visited_cells = []
    GameService.change_player_status_by_action(player, action)
    horizontal_multiplier, vertical_multiplier = GameService.get_horizontal_and_vertical_multiplier(player)

    for i in range(1, player.speed + 1):
        visited_cells.append((player.x + i * horizontal_multiplier, player.y + i * vertical_multiplier))

    # Gap every sixth move, so take only first and last coordinate
    if self.turn.turn_ctr % 6 == 0 and len(visited_cells) &gt; 1:
        visited_cells = [visited_cells[0], visited_cells[-1]]

    visited_cells_result = []
    for (x, y) in visited_cells:
        if x not in range(self.game.width) or y not in range(self.game.height):
            self.set_player_inactive(player)
            break
        player.x = x
        player.y = y
        visited_cells_result.append((x, y))
        if self.game.cells[y][x].players is None or len(self.game.cells[y][x].players) == 0:
            self.game.cells[y][x].players = [player]
        else:
            self.game.cells[y][x].players.append(player)

    return visited_cells_result</code></pre>
</details>
</dd>
<dt id="chillow.service.game_service.GameService.is_game_running"><code class="name flex">
<span>def <span class="ident">is_game_running</span></span>(<span>self) ‑> bool</span>
</code></dt>
<dd>
<div class="desc"><p>Checks if the game is still running.</p>
<h2 id="returns">Returns</h2>
<p>True if the game is still running otherwise False.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def is_game_running(self) -&gt; bool:
    &#34;&#34;&#34;Checks if the game is still running.

    Returns:
        True if the game is still running otherwise False.
    &#34;&#34;&#34;
    active_player_ctr = 0
    for player in self.game.players:
        if player.active:
            active_player_ctr += 1
    return active_player_ctr &gt;= 2</code></pre>
</details>
</dd>
<dt id="chillow.service.game_service.GameService.set_player_inactive"><code class="name flex">
<span>def <span class="ident">set_player_inactive</span></span>(<span>self, player: <a title="chillow.model.player.Player" href="../model/player.html#chillow.model.player.Player">Player</a>)</span>
</code></dt>
<dd>
<div class="desc"><p>Sets a player inactive.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>player</code></strong></dt>
<dd>The player to be set inactive.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def set_player_inactive(self, player: Player):
    &#34;&#34;&#34;Sets a player inactive.

    Args:
        player: The player to be set inactive.
    &#34;&#34;&#34;
    if player in self.turn.playersWithPendingAction:
        self.turn.playersWithPendingAction.remove(player)
    player.active = False</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="chillow.service.game_service.Turn"><code class="flex name class">
<span>class <span class="ident">Turn</span></span>
<span>(</span><span>players: List[<a title="chillow.model.player.Player" href="../model/player.html#chillow.model.player.Player">Player</a>])</span>
</code></dt>
<dd>
<div class="desc"><p>Class that represents a game turn.</p>
<p>Creates a new game turn.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>players</code></strong></dt>
<dd>List of players that are in the game.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Turn:
    &#34;&#34;&#34;Class that represents a game turn.&#34;&#34;&#34;

    def __init__(self, players: List[Player]):
        &#34;&#34;&#34;Creates a new game turn.

        Args:
            players: List of players that are in the game.
        &#34;&#34;&#34;
        self.players = players.copy()
        self.playersWithPendingAction = players.copy()
        self.turn_ctr = 1

    def action(self, player):
        &#34;&#34;&#34;Checks if the player is allowed to take an action.

        If so, removes him from the list of players who must take an action this turn.
        In addition a new turn is started when all players have taken an action.

        Args:
            player: Player who wants to perform an action this turn.

        Returns:
            True if the Turn is ended otherwise False.

        Raises:
            MultipleActionByPlayerException: Raised if the player did more than one action this turn.
        &#34;&#34;&#34;
        if player not in self.playersWithPendingAction:
            raise ex.MultipleActionByPlayerException(player)
        else:
            self.playersWithPendingAction.remove(player)
            if len(self.playersWithPendingAction) == 0:
                self.turn_ctr += 1
                for player in self.players:
                    if player.active:
                        self.playersWithPendingAction.append(player)
                return True
            return False</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="chillow.service.game_service.Turn.action"><code class="name flex">
<span>def <span class="ident">action</span></span>(<span>self, player)</span>
</code></dt>
<dd>
<div class="desc"><p>Checks if the player is allowed to take an action.</p>
<p>If so, removes him from the list of players who must take an action this turn.
In addition a new turn is started when all players have taken an action.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>player</code></strong></dt>
<dd>Player who wants to perform an action this turn.</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>True if the Turn is ended otherwise False.</p>
<h2 id="raises">Raises</h2>
<dl>
<dt><code>MultipleActionByPlayerException</code></dt>
<dd>Raised if the player did more than one action this turn.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def action(self, player):
    &#34;&#34;&#34;Checks if the player is allowed to take an action.

    If so, removes him from the list of players who must take an action this turn.
    In addition a new turn is started when all players have taken an action.

    Args:
        player: Player who wants to perform an action this turn.

    Returns:
        True if the Turn is ended otherwise False.

    Raises:
        MultipleActionByPlayerException: Raised if the player did more than one action this turn.
    &#34;&#34;&#34;
    if player not in self.playersWithPendingAction:
        raise ex.MultipleActionByPlayerException(player)
    else:
        self.playersWithPendingAction.remove(player)
        if len(self.playersWithPendingAction) == 0:
            self.turn_ctr += 1
            for player in self.players:
                if player.active:
                    self.playersWithPendingAction.append(player)
            return True
        return False</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="chillow.service" href="index.html">chillow.service</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="chillow.service.game_service.GameService" href="#chillow.service.game_service.GameService">GameService</a></code></h4>
<ul class="">
<li><code><a title="chillow.service.game_service.GameService.change_player_status_by_action" href="#chillow.service.game_service.GameService.change_player_status_by_action">change_player_status_by_action</a></code></li>
<li><code><a title="chillow.service.game_service.GameService.check_and_set_died_players" href="#chillow.service.game_service.GameService.check_and_set_died_players">check_and_set_died_players</a></code></li>
<li><code><a title="chillow.service.game_service.GameService.do_action" href="#chillow.service.game_service.GameService.do_action">do_action</a></code></li>
<li><code><a title="chillow.service.game_service.GameService.get_and_visit_cells" href="#chillow.service.game_service.GameService.get_and_visit_cells">get_and_visit_cells</a></code></li>
<li><code><a title="chillow.service.game_service.GameService.get_horizontal_and_vertical_multiplier" href="#chillow.service.game_service.GameService.get_horizontal_and_vertical_multiplier">get_horizontal_and_vertical_multiplier</a></code></li>
<li><code><a title="chillow.service.game_service.GameService.is_game_running" href="#chillow.service.game_service.GameService.is_game_running">is_game_running</a></code></li>
<li><code><a title="chillow.service.game_service.GameService.set_player_inactive" href="#chillow.service.game_service.GameService.set_player_inactive">set_player_inactive</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="chillow.service.game_service.Turn" href="#chillow.service.game_service.Turn">Turn</a></code></h4>
<ul class="">
<li><code><a title="chillow.service.game_service.Turn.action" href="#chillow.service.game_service.Turn.action">action</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.2</a>.</p>
</footer>
</body>
</html>